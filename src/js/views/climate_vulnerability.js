Views.ClimateVulnerability = {
  add_layers: (map, town, feature) => {
    var cp = Views.ControlPanel;
    Controllers.Layers.add_custom_layer(cp, {"id": RendererTemplates.ma_climate_vulnerability_layers()[feature],
                                              "name": "" + town + " Climate Vulnerability - " + feature},
                                              {
                                                "town": town
                                              });
    associated_layer_ids = RendererTemplates.ma_climate_vulnerability_associated_layers()[feature];
    var already_active_layers = _.pluck(Views.ControlPanel.get("layers.active"), "layer_default_id");
    Controllers.Layers.force_layers_active(Views.ControlPanel, already_active_layers.concat(associated_layer_ids));

    // Zoom To Town...
    Controllers.Search.execute_search(town + ", MA, USA", (sstr, data) => {
      Views.ControlPanel.fire('zoom-to-search-result', {'context': data.results[0]});
    });

    // Open the report Panel
    cp.set("climate_vulnerability.show_report", {"town": town, "hazard": feature});
  }
};
