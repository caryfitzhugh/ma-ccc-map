RendererTemplates.wms("vulnerability_extreme_heat", {
  parameters: {
    opacity: 70,
    town: "Falmouth",
    layer: "extreme_heat",
    options: {
      town: {
        'Falmouth': "Falmouth",
        'Boston': "Boston",
        'Mashpee': "Mashpee"
      }/*,
      layer: {
        'extreme_heat': "Stormwater extreme_heating",
        'slr': "Sea Level Rise",
        'extreme_heat': "extreme_heat",
        'extreme_heat': "Extreme Heat"
      }*/
    }
  },
  clone_layer_name: function(active_layer) {
    return active_layer.name + " Layer:" + active_layer.parameters.town;
  },
  url: CDN("http://geoserver.nescaum-ccsc-dataservices.com/geoserver/ma/wms"),
  wms_opts:(active_layer) => {
    //var cql_filter=escape("cql_filter=town='Falmouth' AND climate_effect='exposure'");
    var town = active_layer.parameters.town;
    return  {
      layers: 'ma:vulnerability_extreme_heat',
      cql_filter: "town='" + town + "'",
      format: "image/png",
      opacity: 0,
      zIndex: -1,
      transparent: true,
    };
  },
  get_feature_info_url: function (active_layer) {
    var town = active_layer.parameters.town;
/*    var layer = active_layer.parameters.layer;*/

    return CDN("http://geoserver.nescaum-ccsc-dataservices.com/geoserver/ma/wms") +
          "?SERVICE=WMS&VERSION=1.1.1&"+
          "REQUEST=GetFeatureInfo&LAYERS=ma:vulnerability_extreme_heat&"+
          "QUERY_LAYERS=ma:vulnerability_extreme_heat&"+
          "CQL_FILTER=town='" + town + "'&"+
          "PROPERTYNAME=county,town,climate_effect,category,label,stats&"+
          "STYLES=&"+
          "BBOX=<%= bbox %>&"+
          "FEATURE_COUNT=5&"+
          "HEIGHT=<%= height %>&"+
          "WIDTH=<%= width %>&"+
          "FORMAT=text%2Fhtml&"+
          "INFO_FORMAT=application%2Fjson&"+
          "SRS=EPSG%3A4326&"+
          "X=<%= x %>&Y=<%= y %>";
  },
  legend_template: `
      <div class='detail-block show-confidence'>
        <label> Town: </label>
        <select value='{{parameters.town}}'>
        {{#u.to_sorted_values_from_hash(parameters.options.town)}}
          <option value='{{key}}'>{{value}}</option>
        {{/u.to_sorted_values_from_hash(parameters.options.town)}}
        </select>
      </div>
      <div class='detail-block show-confidence'>
        <label> Legend: </label>
          <img src='http://geoserver.nescaum-ccsc-dataservices.com/geoserver/ma/wms?request=GetLegendGraphic&LAYER=ma:vulnerability_extreme_heat&format=image/png'/>
      </div>


  `,
  info_template: `
      <div class='col-xs-2'>
        <label> {{name}} </label>
      </div>
      <div class='col-xs-10'>
        <h3>Vulnerability to Extreme Heat</h3>
        <p>Climate change will have an effect on extreme extreme heat events.  See the chart below to see climate predictions relating to changes in extreme heat and cooling degree dayse for the year 2090.  </p>
        <p>On the map you see locations that are vulnerable to extreme heat, including agricultural areas and SOVI areas</p>
        <h4>Climate Data Chart Goes Here</h4>
        <p><img src='img/deleteme.jpg'></p><br/>
        <h4>Additional info for where you clicked on the map:</h4>
        <table class='table'>
            <thead>
              <tr>
                <th> Town </th>
                <th> Dataset </th>
                <th> Category </th>
                <th> Total for Town </th>
              </tr>
            </thead>
             <tbody>
                {{#json.features}}
                  <tr>
                    <td>{{properties.town}}</td>
                    <td>{{properties.label}}</td>
                    <td>{{properties.category}}</td>
                    <td>{{properties.stats}}</td>
                  </tr>
                {{ else }}
                  Unknown / No Response
                {{/json.features}}
              </tbody>
          </table>      
      </div>
  `
});
